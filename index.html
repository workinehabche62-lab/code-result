<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewresult" content="width=device-width, initial-scale=1.0">
    <title>Damot General School - Student Result</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #004a99; --secondary: #fdfaf5; --border: #ccc; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--secondary); margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .school-banner { background: var(--primary); color: white; padding: 30px; text-align: center; border-bottom: 5px solid #ffcc00; }
        .login-card { padding: 60px 20px; text-align: center; }
        input { width: 90%; max-width: 350px; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; outline: none; }
        .btn-main { background: var(--primary); color: white; padding: 14px 40px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; }
        #resultArea { display: none; padding: 20px; }
        .profile-header { display: flex; align-items: center; gap: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 20px; margin-bottom: 20px; }
        .student-photo { width: 120px; height: 120px; border-radius: 10px; border: 3px solid var(--primary); object-fit: cover; background: #eee; }
        .grid-info { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; text-align: left; }
        .info-cell { border-bottom: 1px solid #eee; padding: 8px 0; }
        .info-cell label { font-size: 11px; color: #888; text-transform: uppercase; font-weight: bold; }
        .summary-ribbon { display: flex; justify-content: space-around; background: #f8f9fa; border-radius: 10px; padding: 20px; border: 1px solid #eee; }
        .ribbon-item { text-align: center; }
        .ribbon-item b { font-size: 22px; color: var(--primary); display: block; }
        .status-highlight { font-size: 28px; font-weight: 900; color: #008000; text-transform: uppercase; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f1f1f1; text-align: center; padding: 12px; font-size: 13px; border: 1px solid var(--border); }
        td { padding: 12px; border: 1px solid var(--border); text-align: center; font-size: 14px; }
        .action-bar { display: flex; gap: 10px; margin-top: 30px; justify-content: center; }
        .btn-action { padding: 12px 25px; border-radius: 6px; cursor: pointer; border: none; font-weight: bold; text-decoration: none; }
        .btn-download { background: #0056b3; color: white; }
        .btn-complaint { background: #25d366; color: white; }
    </style>
</head>
<body>

<div class="container" id="printableArea">
    <div class="school-banner">
        <h1>DAMOT GENERAL SECONDARY SCHOOL</h1>
        <p style="margin: 5px 0 0; opacity: 0.8;">Student Result Management Portal</p>
    </div>

    <div id="loginSection" class="login-card">
        <input type="text" id="regID" placeholder="Registration Number (156100)">
        <input type="password" id="regPass" placeholder="Password">
        <br><br>
        <button class="btn-main" onclick="loadStudentResult()">viewresult</button>
    </div>

    <div id="resultArea">
        <div class="profile-header">
            <img id="pPhoto" src="" class="student-photo" alt="Student Profile">
            <div>
                <h2 id="pName" style="margin:0; color:var(--primary);"></h2>
                <div id="pHeaderStatus" class="status-highlight"></div>
            </div>
        </div>

        <div class="grid-info">
            <div class="info-cell"><label>Registration No</label><div id="pID"></div></div>
            <div class="info-cell"><label>Gender</label><div id="pGen"></div></div>
            <div class="info-cell"><label>Grade & Section</label><div id="pGrade"></div></div>
            <div class="info-cell"><label>Academic Year</label><div id="pYear"></div></div>
            <div class="info-cell"><label>Nationality</label><div id="pNat"></div></div>
            <div class="info-cell"><label>Zone</label><div id="pZone"></div></div>
            <div class="info-cell"><label>Woreda</label><div id="pWor"></div></div>
            <div class="info-cell"><label>School</label><div id="pSch"></div></div>
        </div>

        <div class="summary-ribbon">
            <div class="ribbon-item"><span>Total (100%)</span><b id="pTotal"></b></div>
            <div class="ribbon-item"><span>Average</span><b id="pAvg"></b></div>
            <div class="ribbon-item"><span>Status</span><b id="pRibbonStatus" style="color: #008000;"></b></div>
        </div>

        <table>
            <thead>
                <tr>
                    <th rowspan="2">Subject Name</th>
                    <th colspan="2">Assessment Scores</th>
                    <th rowspan="2">Total (100)</th>
                    <th rowspan="2">Grade</th>
                </tr>
                <tr>
                    <th>40%</th>
                    <th>60%</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="action-bar">
            <button class="btn-action btn-download" onclick="downloadPDF()">Download PDF</button>
            <a href="tel:0961364574" class="btn-action btn-complaint">Complaint: 0961364574</a>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDqX185jJuZU5SGEjVVNCGNh5aS0hgov58",
      authDomain: "damoto-school-result.firebaseapp.com",
      databaseURL: "https://damoto-school-result-default-rtdb.firebaseio.com",
      projectId: "damoto-school-result",
      storageBucket: "damoto-school-result.firebasestorage.app",
      messagingSenderId: "419800691638",
      appId: "1:419800691638:web:d08ae5311b85f24bb28717"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadStudentResult() {
        const id = document.getElementById('regID').value;
        const pass = document.getElementById('regPass').value;

        db.ref('students/' + id).once('value').then(snap => {
            const data = snap.val();
            if(data && data.password == pass) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('resultArea').style.display = 'block';

                document.getElementById('pPhoto').src = data.photoURL || "";
                document.getElementById('pName').innerText = data.name || "N/A";
                document.getElementById('pID').innerText = id;
                document.getElementById('pGen').innerText = data.gender || "Male";
                document.getElementById('pGrade').innerText = (data.grade || "") + " (" + (data.section || "") + ")";
                document.getElementById('pYear').innerText = data.academicYear || "2018 E.C";
                document.getElementById('pNat').innerText = data.nationality || "Ethiopian";
                document.getElementById('pZone').innerText = data.zone || "West Gojjam";
                document.getElementById('pWor').innerText = data.woreda || "Finote Selam";
                document.getElementById('pSch').innerText = data.school || "Damot General Secondary School";
                document.getElementById('pTotal').innerText = data.total || "0";
                document.getElementById('pAvg').innerText = (data.average || "0") + "%";
                
                const statusValue = data.status || "PASSED";
                document.getElementById('pHeaderStatus').innerText = statusValue;
                document.getElementById('pRibbonStatus').innerText = statusValue;

                // 40% እና 60% ዳታዎችን እዚህ ጋር በትክክል እንቀበላለን
                const subjects = [
                    { name: "Mathematics", s40: data.maths40, s60: data.maths60, tot: data.maths },
                    { name: "English", s40: data.english40, s60: data.english60, tot: data.english },
                    { name: "Biology", s40: data.biology40, s60: data.biology60, tot: data.biology },
                    { name: "Chemistry", s40: data.chemistry40, s60: data.chemistry60, tot: data.chemistry },
                    { name: "Physics", s40: data.physics40, s60: data.physics60, tot: data.physics },
                    { name: "Geography", s40: data.geography40, s60: data.geography60, tot: data.geography }
                ];

                let tableRows = "";
                subjects.forEach(s => {
                    let grade = s.tot >= 90 ? "A+" : s.tot >= 80 ? "A" : s.tot >= 70 ? "B" : s.tot >= 50 ? "C" : "D";
                    // 0 ቢሆኑም ቁጥሮቹን እንዲያሳይ s40 || 0 ተብሏል
                    tableRows += `<tr>
                        <td style="text-align:left">${s.name}</td>
                        <td>${s.s40 !== undefined ? s.s40 : "-"}</td>
                        <td>${s.s60 !== undefined ? s.s60 : "-"}</td>
                        <td><b>${s.tot || 0}</b></td>
                        <td>${grade}</td>
                    </tr>`;
                });
                document.getElementById('tableBody').innerHTML = tableRows;

            } else { alert("ID or Password incorrect!"); }
        });
    }

    function downloadPDF() {
        const element = document.getElementById('printableArea');
        html2pdf().from(element).save('Student_Result.pdf');
    }
</script><script>
    // Firebase ማገናኛ (config) እንዳለ ሆኖ ከስር ያለውን Function አስተካክለው
    function loadStudentResult() {
        const id = document.getElementById('regID').value;
        const pass = document.getElementById('regPass').value;

        db.ref('students/' + id).once('value').then(snap => {
            const data = snap.val();
            if(data && data.password == pass) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('resultArea').style.display = 'block';

                // የግል መረጃዎች
                document.getElementById('pPhoto').src = data.photoURL || "";
                document.getElementById('pName').innerText = data.name || "N/A";
                document.getElementById('pID').innerText = id;
                document.getElementById('pGen').innerText = data.gender || "Male";
                document.getElementById('pGrade').innerText = (data.grade || "") + " (" + (data.section || "") + ")";
                document.getElementById('pYear').innerText = data.academicYear || "2018 E.C";
                document.getElementById('pNat').innerText = data.nationality || "Ethiopian";
                document.getElementById('pZone').innerText = data.zone || "West Gojjam";
                document.getElementById('pWor').innerText = data.woreda || "Finote Selam";
                document.getElementById('pSch').innerText = data.school || "Damot General Secondary School";
                
                // ማጠቃለያ
                document.getElementById('pTotal').innerText = data.total || "0";
                document.getElementById('pAvg').innerText = (data.average || "0") + "%";
                
                const statusValue = data.status || "PASSED";
                document.getElementById('pHeaderStatus').innerText = statusValue;
                document.getElementById('pRibbonStatus').innerText = statusValue;

                // የትምህርት ውጤቶች (40% እና 60% እዚህ ጋር ነው የሚመጡት)
                const subjects = [
                    { name: "Mathematics", s40: data.maths40, s60: data.maths60, tot: data.maths },
                    { name: "English", s40: data.english40, s60: data.english60, tot: data.english },
                    { name: "Biology", s40: data.biology40, s60: data.biology60, tot: data.biology },
                    { name: "Chemistry", s40: data.chemistry40, s60: data.chemistry60, tot: data.chemistry },
                    { name: "Physics", s40: data.physics40, s60: data.physics60, tot: data.physics },
                    { name: "Geography", s40: data.geography40, s60: data.geography60, tot: data.geography }
                ];

                let tableRows = "";
                subjects.forEach(s => {
                    let grade = s.tot >= 90 ? "A+" : s.tot >= 80 ? "A" : s.tot >= 70 ? "B" : s.tot >= 50 ? "C" : "D";
                    tableRows += `<tr>
                        <td style="text-align:left">${s.name}</td>
                        <td>${s.s40 !== undefined ? s.s40 : "0"}</td>
                        <td>${s.s60 !== undefined ? s.s60 : "0"}</td>
                        <td><b>${s.tot || 0}</b></td>
                        <td>${grade}</td>
                    </tr>`;
                });
                document.getElementById('tableBody').innerHTML = tableRows;

            } else { alert("ID or Password incorrect!"); }
        });
    }
</script>
</body>
</html>l>